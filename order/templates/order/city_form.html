{% load i18n widget_tweaks %}

<div class="form-group {{ field.html_name }}{% if field.errors %} has-error has-feedback{% endif %}">
    {% if field|field_type == 'booleanfield' %}
        <div class="checkbox"><label>{{ field }} {{ field.label }}</label></div>
    {% else %}
        <label class="control-label" for="{{ field.id_for_label }}">{{ field.label }}</label>
        <div class="form-field">
            {% with field.field.required|yesno:"required," as attr %}
                {{ field|attr:attr|add_class:"form-control" }}
            {% endwith %}
            {% if field.errors %}
                <span class="glyphicon glyphicon-warning-sign form-control-feedback"></span>
                {{ field.errors }}
            {% endif %}
        </div>
    {% endif %}
</div>

<script>
    $(function () {
        $('#id_address_city').autocomplete({
            source: function (request, response) {
                $.ajax({
                    url: "{% url "order:get_cities" %}",
                    dataType: "json",
                    data: {
                        q: request.term
                    },
                    success: function (data) {
                        response(data);
                    }
                });
            },
            minLength: 2,
            position: {
                my: "left top", at: "left bottom"
            },
            select: function (event, ui) {
                (function () {
                    $(function () {
                        var after, selectDeliveryCity;
                        after = function (ms, cb) {
                            return setTimeout(cb, ms);
                        };
                        selectDeliveryCity = function () {
                            var city, url;
                            city = $('#id_address_city').val();
                            url = $('#delivery-location-name').data('delivery-source');
                            return $.get(url, "city=" + city, function (data) {
                                $('#delivery-variants').html(data);
                                $('#delivery-variants input').iCheck({
                                    checkboxClass: 'icheckbox_fs',
                                    radioClass: 'iradio_fs'
                                });
                                $('#delivery-location-name').text(city);
                                return $('#delivery-location').show();
                            });
                        };
                        selectDeliveryCity();
                        return $('#id_address_city').change(selectDeliveryCity);
                    });

                }).call(this);
            }
        })
    })
</script>